import{s as t,a as e}from"./chunks/vendor-motion.js";class s{constructor(){this.booksContainer=document.querySelector(".guides-books-container"),this.booksList=document.querySelector(".guides-book-list"),this.books=this.booksList.querySelectorAll(".guides-book-wrap"),this.modalsWrapper=document.querySelector(".guides-modals"),this.modalBg=document.querySelector(".guides-modal-bg"),this.modalsList=document.querySelector(".guides-modals-list"),this.modals=document.querySelectorAll(".guides-modal"),this.modalSliderBtnLeft=document.querySelector(".guides-modal-slider-arrow.cc-left"),this.modalSliderBtnRight=document.querySelector(".guides-modal-slider-arrow.cc-right"),this.booksList.removeAttribute("role"),this.isOpen=!1,this.currentIndex=0,this.modalIndices=new Map,this.modals.forEach(((t,e)=>{this.modalIndices.set(t.dataset.modal,e)})),this.MODAL_WIDTH=1014,this.MODAL_GAP=48,this.isAnimating=!1,this.isOpeningOrClosing=!1,this.springs={opening:{type:t,visualDuration:.38,bounce:.24},closing:{type:t,visualDuration:.3,bounce:.18},navigation:{type:t,duration:.9,bounce:.14,velocity:1e3}},this.init()}init(){this.updatePositions(),this.books.forEach((t=>{t.addEventListener("click",(()=>this.open(t)))})),this.modals.forEach((t=>{const e=t.querySelector(".guides-modal-close");null==e||e.addEventListener("click",(()=>this.close()))})),this.modalBg.addEventListener("click",(()=>this.close())),document.addEventListener("keydown",(t=>{this.isOpen&&("Escape"===t.key&&(t.preventDefault(),this.close()),"ArrowLeft"===t.key&&this.navigate("prev"),"ArrowRight"===t.key&&this.navigate("next"))})),this.modalSliderBtnLeft.addEventListener("click",(()=>this.navigate("prev"))),this.modalSliderBtnRight.addEventListener("click",(()=>this.navigate("next"))),window.addEventListener("resize",(()=>{this.isOpen&&this.updateModalPosition()}))}getBookMetrics(t){const e=t.getBoundingClientRect();return{left:e.left,top:e.top,width:e.width,height:e.height}}updatePositions(){this.isOpen&&this.updateModalPosition()}async open(t){if(this.isAnimating)return;this.isAnimating=!0,this.isOpeningOrClosing=!0,document.body.style.overflow="hidden",this.isOpen=!0;const s=t.dataset.bookId,o=document.querySelector(`.guides-modal[data-modal="${s}"]`);if(!o)return;this.currentIndex=this.modalIndices.get(s),this.lastClickedBook=t,requestAnimationFrame((()=>{t.style.opacity="0",t.style.transform=""})),this.modalsWrapper.style.display="flex",this.modalsWrapper.style.opacity="0",this.modals.forEach(((t,e)=>{t.style.opacity="1",t.style.transform="";const s=t.querySelector(".guides-modal-content"),o=t.querySelector(".guides-modal-book .guides-book-wrap");s.style.opacity=e===this.currentIndex?"1":"0",o.style.opacity=e===this.currentIndex?"1":"0"})),this.modalsList.style.transform=`translateX(-${this.currentIndex*(this.MODAL_WIDTH+this.MODAL_GAP)}px)`;const i=this.modals[this.currentIndex-1],n=this.modals[this.currentIndex+1];i&&(i.style.opacity="0",i.style.transform="translateX(-100px)"),n&&(n.style.opacity="0",n.style.transform="translateX(100px)");const a={book:this.getBookMetrics(t),modal:o.getBoundingClientRect(),modalBook:o.querySelector(".guides-modal-book").getBoundingClientRect(),modalInner:o.querySelector(".guides-modal-inner").getBoundingClientRect()},r=a.modalBook.top,l=Array.from(this.booksList.querySelectorAll(".guides-book-wrap")).filter((e=>e!==t)).map((t=>{const s=(this.modalIndices.get(t.dataset.bookId)-this.currentIndex)*(this.MODAL_WIDTH+this.MODAL_GAP),o=t.getBoundingClientRect(),i=r-o.top,n=t.querySelector(".guides-book-inner");return e(n,{x:[0,s],y:[0,i],opacity:[1,0]},this.springs.opening)})),d={modal:o,modalBook:o.querySelector(".guides-modal-book"),modalInner:o.querySelector(".guides-modal-inner"),modalBookInner:o.querySelector(".guides-modal-book .guides-book")},c={dx:a.book.left-a.modalBook.left,dy:a.book.top-a.modalBook.top,scale:a.book.width/d.modalBook.offsetWidth},h={dx:a.book.left-a.modalInner.left,dy:a.book.top-a.modalInner.top,scale:a.book.width/this.MODAL_WIDTH};d.modalBook.style.cssText=`\n      transform-origin: top left;\n      transform: translate(${c.dx}px, ${c.dy}px) scale(${c.scale});\n      opacity: 1;\n    `,d.modalBookInner.style.transform="rotateY(-40deg)",d.modalInner.style.cssText=`\n      transform-origin: top left;\n      transform: translate(${h.dx}px, ${h.dy}px) scale(${h.scale});\n      opacity: 0;\n    `,this.modalsWrapper.style.opacity="1";try{await Promise.all([e(this.modalBg,{opacity:[0,1]},{duration:.4}),...l,i&&e(i,{opacity:[0,1],transform:["translateX(-100px) scale(0.8)","translateX(0px) scale(1)"]},{...this.springs.opening,delay:.2}),n&&e(n,{opacity:[0,1],transform:["translateX(100px) scale(0.8)","translateX(0px) scale(1)"]},{...this.springs.opening,delay:.2}),e(d.modalBook,{transform:[`translate(${c.dx}px, ${c.dy}px) scale(${c.scale})`,"translate(0px, 0px) scale(1)"],opacity:[1,1]},this.springs.opening),e(d.modalBookInner,{rotateY:[-40,0],scale:[1.05,1]},this.springs.opening),e(d.modalInner,{transform:[`translate(${h.dx}px, ${h.dy}px) scale(${h.scale})`,"translate(0px, 0px) scale(1)"],opacity:[0,1]},this.springs.opening)].filter(Boolean))}finally{this.isAnimating=!1,this.isOpeningOrClosing=!1}}async close(){if(this.isAnimating)return;this.isAnimating=!0,this.isOpeningOrClosing=!0;const t=this.modals[this.currentIndex],s=this.modals[this.currentIndex-1],o=this.modals[this.currentIndex+1],i=t.dataset.modal,n=Array.from(this.books).find((t=>t.dataset.bookId===i));Array.from(this.books).forEach((t=>{t===n?requestAnimationFrame((()=>{t.style.opacity="0",t.style.transform=""})):(t.style.transform="",t.style.opacity="1")}));const a=t.querySelector(".guides-modal-book").getBoundingClientRect().top,r=Array.from(this.books).map((t=>{if(t===n)return null;const s=t.querySelector(".guides-book-inner"),o=(this.modalIndices.get(t.dataset.bookId)-this.currentIndex)*(this.MODAL_WIDTH+this.MODAL_GAP),i=t.getBoundingClientRect(),r=a-i.top;return e(s,{x:[`${o}px`,"0px"],y:[`${r}px`,"0px"],opacity:[0,1]},this.springs.closing)})).filter(Boolean),l=this.getBookMetrics(n),d=t.querySelector(".guides-modal-book").getBoundingClientRect(),c=t.querySelector(".guides-modal-inner").getBoundingClientRect(),h={modalBook:t.querySelector(".guides-modal-book"),modalInner:t.querySelector(".guides-modal-inner")},m={dx:l.left-d.left,dy:l.top-d.top,scale:l.width/h.modalBook.offsetWidth},p={dx:l.left-c.left,dy:l.top-c.top,scale:l.width/this.MODAL_WIDTH};h.modalBook.style.transformOrigin="top left",h.modalInner.style.transformOrigin="top left";try{await Promise.all([...r,s&&e(s,{opacity:[1,0],transform:["translateX(0%) scale(1)","translateX(50%) scale(0.8)"]},this.springs.closing),o&&e(o,{opacity:[1,0],transform:["translateX(0%) scale(1)","translateX(-50%) scale(0.8)"]},this.springs.closing),e(h.modalBook,{transform:["translate(0px, 0px) scale(1)",`translate(${m.dx}px, ${m.dy}px) scale(${m.scale})`]},this.springs.closing),e(h.modalInner,{transform:["translate(0px, 0px) scale(1)",`translate(${p.dx}px, ${p.dy}px) scale(${p.scale})`],opacity:[1,0]},this.springs.closing),e(this.modalBg,{opacity:[1,0]},{duration:.3})].filter(Boolean))}finally{this.isAnimating=!1,this.isOpeningOrClosing=!1,this.lastClickedBook=null,requestAnimationFrame((()=>{this.modalsWrapper.style.display="none",this.isOpen=!1,h.modalBook.style.cssText="",h.modalInner.style.cssText="",n&&(n.style.opacity="1",n.style.transform=""),Array.from(this.books).forEach((t=>{t.style.opacity="1",t.style.transform=""})),document.body.style.overflow=""}))}}navigate(t){if(this.isOpeningOrClosing)return;this.isAnimating=!0;const s="prev"===t?Math.max(0,this.currentIndex-1):Math.min(this.modals.length-1,this.currentIndex+1);if(s===this.currentIndex)return;this.modalSliderBtnLeft.style.visibility=s<=0?"hidden":"visible",this.modalSliderBtnRight.style.visibility=s>=this.modals.length-1?"hidden":"visible";const o=this.modals[this.currentIndex],i=this.modals[s],n=o.querySelector(".guides-modal-content"),a=o.querySelector(".guides-modal-book .guides-book-wrap"),r=i.querySelector(".guides-modal-content"),l=i.querySelector(".guides-modal-book .guides-book-wrap");r.style.opacity="0",l.style.opacity="0",Promise.all([e(this.modalsList,{x:[-this.currentIndex*(this.MODAL_WIDTH+this.MODAL_GAP)+"px",-s*(this.MODAL_WIDTH+this.MODAL_GAP)+"px"]},this.springs.navigation),e([n,a],{opacity:[1,0]},this.springs.navigation),e([r,l],{opacity:[0,1]},this.springs.navigation)]).finally((()=>{this.isAnimating=!1})),this.currentIndex=s}updateModalPosition(){this.modalsList.style.transform=`translateX(-${this.currentIndex*(this.MODAL_WIDTH+this.MODAL_GAP)}px)`}}document.addEventListener("keydown",(function(t){"ArrowLeft"!==t.key&&"ArrowRight"!==t.key||t.preventDefault()})),document.querySelector(".guides-books-container").addEventListener("focus",(t=>{t.preventDefault(),document.querySelector(".guides-book-wrap").focus()})),document.addEventListener("DOMContentLoaded",(()=>{new s}));
