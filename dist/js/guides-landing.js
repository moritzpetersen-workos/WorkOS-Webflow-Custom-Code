import{s as t,a as e}from"./chunks/vendor-motion.js";class o{constructor(){this.booksContainer=document.querySelector(".guides-books-container"),this.booksList=document.querySelector(".guides-book-list"),this.books=this.booksList.querySelectorAll(".guides-book-wrap"),this.modalsWrapper=document.querySelector(".guides-modals"),this.modalBg=document.querySelector(".guides-modal-bg"),this.modalsList=document.querySelector(".guides-modals-list"),this.modals=document.querySelectorAll(".guides-modal"),this.modalSliderBtnLeft=document.querySelector(".guides-modal-slider-arrow.cc-left"),this.modalSliderBtnRight=document.querySelector(".guides-modal-slider-arrow.cc-right"),this.booksList.removeAttribute("role"),this.isOpen=!1,this.currentIndex=0,this.isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),this.modalIndices=new Map,this.modals.forEach(((t,e)=>{this.modalIndices.set(t.dataset.modal,e)})),this.MODAL_WIDTH=1014,this.MODAL_GAP=56,this.isAnimating=!1,this.isOpeningOrClosing=!1,this.springs={opening:{type:t,visualDuration:.38,bounce:.24},closing:{type:t,visualDuration:.3,bounce:.24},navigation:{type:t,duration:.9,bounce:.14,velocity:1e3}},this.updateArrowVisibility(0),this.init()}init(){this.updatePositions(),this.books.forEach((t=>{t.addEventListener("click",(()=>this.open(t)))})),this.modals.forEach((t=>{const e=t.querySelector(".guides-modal-close");null==e||e.addEventListener("click",(()=>this.close()))})),this.modalBg.addEventListener("click",(()=>this.close())),document.addEventListener("keydown",(t=>{this.isOpen&&("Escape"===t.key&&(t.preventDefault(),this.close()),"ArrowLeft"===t.key&&this.navigate("prev"),"ArrowRight"===t.key&&this.navigate("next"))})),this.modalSliderBtnLeft.addEventListener("click",(()=>this.navigate("prev"))),this.modalSliderBtnRight.addEventListener("click",(()=>this.navigate("next"))),window.addEventListener("resize",(()=>{this.isOpen&&this.updateModalPosition()}))}getBookMetrics(t){const e=t.getBoundingClientRect();return{left:e.left,top:e.top,width:e.width,height:e.height}}updatePositions(){this.isOpen&&this.updateModalPosition()}updateArrowVisibility(t){this.modalSliderBtnLeft.classList.toggle("is-active",t>0),this.modalSliderBtnRight.classList.toggle("is-active",t<this.modals.length-1)}async open(t){if(this.isAnimating)return;this.isAnimating=!0,this.isOpeningOrClosing=!0,document.body.style.overflow="hidden",this.modalsWrapper.classList.add("is-opened"),this.isOpen=!0;const o=t.dataset.bookId,s=document.querySelector(`.guides-modal[data-modal="${o}"]`);if(!s)return;this.currentIndex=this.modalIndices.get(o),this.updateArrowVisibility(this.currentIndex),this.lastOpenedBookScroll={left:this.booksContainer.scrollLeft,bookLeft:t.offsetLeft},requestAnimationFrame((()=>{t.style.opacity="0",t.style.transform=""})),this.modalsWrapper.style.display="flex",this.modalsWrapper.style.opacity="0",this.modals.forEach(((t,e)=>{t.style.opacity="1",t.style.transform="";const o=t.querySelector(".guides-modal-content"),s=t.querySelector(".guides-modal-book .guides-book-wrap");o.style.opacity=e===this.currentIndex?"1":"0",s.style.opacity=e===this.currentIndex?"1":"0"})),this.modalsList.style.transform=`translateX(-${this.currentIndex*(this.MODAL_WIDTH+this.MODAL_GAP)}px)`;const i=this.modals[this.currentIndex-1],n=this.modals[this.currentIndex+1];i&&(i.style.opacity="0",i.style.transform="translateX(-100px)"),n&&(n.style.opacity="0",n.style.transform="translateX(100px)");const a={book:this.getBookMetrics(t),modal:s.getBoundingClientRect(),modalBook:s.querySelector(".guides-modal-book").getBoundingClientRect(),modalInner:s.querySelector(".guides-modal-inner").getBoundingClientRect()},r=a.modalBook.top,l=Array.from(this.booksList.querySelectorAll(".guides-book-wrap")).filter((e=>e!==t)).map((t=>{const o=(this.modalIndices.get(t.dataset.bookId)-this.currentIndex)*(this.MODAL_WIDTH+this.MODAL_GAP),s=t.getBoundingClientRect(),i=r-s.top,n=t.querySelector(".guides-book-inner");return e(n,this.isSafari?{transform:["translate(0px, 0px)",`translate(${o}px, ${i}px)`],opacity:[1,0]}:{x:[0,o],y:[0,i],opacity:[1,0]},this.springs.opening)})),d={modal:s,modalBook:s.querySelector(".guides-modal-book"),modalInner:s.querySelector(".guides-modal-inner"),modalBookInner:s.querySelector(".guides-modal-book .guides-book")},c={dx:a.book.left-a.modalBook.left,dy:a.book.top-a.modalBook.top,scale:a.book.width/d.modalBook.offsetWidth},h={dx:a.book.left-a.modalInner.left,dy:a.book.top-a.modalInner.top,scale:a.book.width/this.MODAL_WIDTH};d.modalBook.style.cssText=`\n      transform-origin: top left;\n      transform: translate(${c.dx}px, ${c.dy}px) scale(${c.scale});\n      opacity: 1;\n    `,d.modalBookInner.style.transform="rotateY(-40deg)",d.modalInner.style.cssText=`\n      transform-origin: top left;\n      transform: translate(${h.dx}px, ${h.dy}px) scale(${h.scale});\n      opacity: 0;\n    `,this.modalsWrapper.style.opacity="1";try{await Promise.all([e(this.modalBg,{opacity:[0,1]},{duration:.38}),...l,i&&e(i,{opacity:[0,1],transform:["translateX(-100px)","translateX(0px)"]},{duration:.3,delay:.2}),n&&e(n,{opacity:[0,1],transform:["translateX(100px)","translateX(0px)"]},{duration:.3,delay:.2}),e(d.modalBook,{transform:[`translate(${c.dx}px, ${c.dy}px) scale(${c.scale})`,"translate(0px, 0px) scale(1)"],opacity:[1,1]},this.springs.opening),e(d.modalBookInner,{rotateY:[-40,0],scale:[1.05,1]},this.springs.opening),e(d.modalInner,{transform:[`translate(${h.dx}px, ${h.dy}px) scale(${h.scale})`,"translate(0px, 0px) scale(1)"],opacity:[0,1]},this.springs.opening)].filter(Boolean))}finally{this.isAnimating=!1,this.isOpeningOrClosing=!1}}async close(){if(this.isAnimating)return;this.isAnimating=!0,this.isOpeningOrClosing=!0,this.modalsWrapper.classList.remove("is-opened");const t=this.modals[this.currentIndex],o=this.modals[this.currentIndex-1],s=this.modals[this.currentIndex+1],i=t.dataset.modal,n=Array.from(this.books).find((t=>t.dataset.bookId===i)),a=null==n?void 0:n.querySelector(".guides-book-inner");if(n){const t=this.booksContainer.offsetWidth,e=n.offsetLeft,o=e+n.offsetWidth,s=this.booksContainer.scrollLeft;(e<s||o>s+t)&&(this.booksContainer.scrollLeft=Math.min(e,o-t))}await new Promise((t=>{requestAnimationFrame((()=>requestAnimationFrame(t)))})),a&&(a.style.transform="",a.style.opacity="0");const r=t.querySelector(".guides-modal-book").getBoundingClientRect().top,l=Array.from(this.books).filter((t=>t!==n)).map((t=>{const o=(this.modalIndices.get(t.dataset.bookId)-this.currentIndex)*(this.MODAL_WIDTH+this.MODAL_GAP),s=t.getBoundingClientRect(),i=r-s.top,n=t.querySelector(".guides-book-inner");return t.style.opacity="1",n.style.opacity="0",e(n,this.isSafari?{transform:[`translate(${o}px, ${i}px)`,"translate(0px, 0px)"],opacity:[0,1]}:{x:[o,0],y:[i,0],opacity:[0,1]},{type:"spring",visualDuration:.35,bounce:.15})})),d=this.getBookMetrics(n),c=t.querySelector(".guides-modal-book").getBoundingClientRect(),h=t.querySelector(".guides-modal-inner").getBoundingClientRect(),m={modalBook:t.querySelector(".guides-modal-book"),modalInner:t.querySelector(".guides-modal-inner")},p={dx:d.left-c.left,dy:d.top-c.top,scale:d.width/m.modalBook.offsetWidth},u={dx:d.left-h.left,dy:d.top-h.top,scale:d.width/this.MODAL_WIDTH};m.modalBook.style.transformOrigin="top left",m.modalInner.style.transformOrigin="top left";try{await Promise.all([...l,o&&e(o,{opacity:[1,0],transform:["translateX(0px) scale(1)","translateX(100px) scale(0.9)"]},{duration:.15}),s&&e(s,{opacity:[1,0],transform:["translateX(0px) scale(1)","translateX(-100px) scale(0.9)"]},{duration:.15}),e(m.modalBook,{transform:["translate(0px, 0px) scale(1)",`translate(${p.dx}px, ${p.dy}px) scale(${p.scale})`]},this.springs.closing),e(m.modalInner,{transform:["translate(0px, 0px) scale(1)",`translate(${u.dx}px, ${u.dy}px) scale(${u.scale})`],opacity:[1,0]},this.springs.closing),e(this.modalBg,{opacity:[1,0]},{duration:.3})].filter(Boolean))}finally{this.isAnimating=!1,this.isOpeningOrClosing=!1,requestAnimationFrame((()=>{this.modalsWrapper.style.display="none",this.isOpen=!1,m.modalBook.style.cssText="",m.modalInner.style.cssText="",Array.from(this.books).forEach((t=>{const e=t.querySelector(".guides-book-inner");t.style.opacity="1",t.style.transform="",e.style.opacity="1",e.style.transform=""})),document.body.style.overflow=""}))}}navigate(t){if(this.isOpeningOrClosing)return;this.isAnimating=!0;const o="prev"===t?Math.max(0,this.currentIndex-1):Math.min(this.modals.length-1,this.currentIndex+1);if(o===this.currentIndex)return;this.updateArrowVisibility(o);const s=this.modals[this.currentIndex],i=this.modals[o],n=s.querySelector(".guides-modal-content"),a=s.querySelector(".guides-modal-book .guides-book-wrap"),r=i.querySelector(".guides-modal-content"),l=i.querySelector(".guides-modal-book .guides-book-wrap");r.style.opacity="0",l.style.opacity="0",Promise.all([e(this.modalsList,{x:[-this.currentIndex*(this.MODAL_WIDTH+this.MODAL_GAP)+"px",-o*(this.MODAL_WIDTH+this.MODAL_GAP)+"px"]},this.springs.navigation),e([n,a],{opacity:[1,0]},{duration:.2}),e([r,l],{opacity:[0,1]},{duration:.2})]).finally((()=>{this.isAnimating=!1})),this.currentIndex=o}updateModalPosition(){this.modalsList.style.transform=`translateX(-${this.currentIndex*(this.MODAL_WIDTH+this.MODAL_GAP)}px)`}destroy(){this.visibleBooksObserver.disconnect()}}document.addEventListener("keydown",(function(t){"ArrowLeft"!==t.key&&"ArrowRight"!==t.key||t.preventDefault()})),document.addEventListener("DOMContentLoaded",(()=>{new o}));
