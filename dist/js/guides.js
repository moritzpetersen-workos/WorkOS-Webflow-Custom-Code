(()=>{const t=document.querySelectorAll(".post-rt h2"),e=document.querySelector(".post-toc-wrap"),o=document.querySelector(".post-toc-inner");if(t.length<2||!e)return void(o&&(o.style.display="none"));const n={};t.forEach((t=>{const e=t.textContent.trim();n[e]=(n[e]||0)+1}));const c={},r=t=>{const e=t.toLowerCase().trim().replace(/^[\d.]+\s*/,"").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");return 1===n[t]?e:(c[t]=(c[t]||0)+1,`${e}-${c[t]}`)},s="introduction",i=document.createElement("div");i.classList.add("article-content-section"),i.id=s,t.forEach((t=>{const e=r(t.textContent),o=document.createElement("div");o.classList.add("article-content-section"),o.id=e,t.parentNode.insertBefore(o,t),o.appendChild(t);let n=o.nextSibling;for(;n&&!n.matches("h2");){const t=n;n=n.nextSibling,o.appendChild(t)}}));const a=document.querySelector(".post-rt");if(a&&(a.insertBefore(i,a.firstChild),t.length>0)){const e=t[0].parentNode;let o=a.firstChild;for(;o&&o!==e;){const t=o.nextSibling;o===i||o.matches("h2")||i.appendChild(o),o=t}}const l=document.createElement("ul");l.classList.add("toc-list"),o.appendChild(l);const d=document.createElement("li");d.classList.add("toc-item");const m=document.createElement("a");m.textContent="Introduction",m.href=`#${s}`,m.classList.add("toc-a"),m.addEventListener("click",(t=>{t.preventDefault(),window.scrollTo({top:0,behavior:"smooth"}),v(i)})),d.appendChild(m),l.appendChild(d),d.classList.add("active");let u=m;t.forEach((t=>{const e=t.textContent.trim(),o=r(e);t.parentElement.id=o;const n=document.createElement("li");n.classList.add("toc-item");const c=document.createElement("a");c.textContent=e,c.href=`#${o}`,c.classList.add("toc-a"),n.appendChild(c),l.appendChild(n)}));const h=o.querySelectorAll(".toc-a");requestAnimationFrame((()=>{h.forEach((t=>{const e=t.offsetHeight;t.style.setProperty("--expanded-link-height",`${e}px`)}))}));const p=document.querySelectorAll(".article-content-section");let f,g=!1;const v=t=>{if(!t)return;const o=e.querySelector(`a[href="#${t.id}"]`);o!==u&&requestAnimationFrame((()=>{var t;u&&(null==(t=u.closest(".toc-item"))||t.classList.remove("active")),requestAnimationFrame((()=>{var t;o&&(null==(t=o.closest(".toc-item"))||t.classList.add("active"),u=o)}))}))};e.addEventListener("click",(t=>{t.stopPropagation();const e=t.target.closest("a");if(!e||!e.hash)return;if(e.hash===`#${s}`)return;t.preventDefault();const o=document.querySelector(e.hash);o&&(g=!0,clearTimeout(f),f=setTimeout((()=>{g=!1}),1200),o.scrollIntoView({behavior:"smooth"}),v(o))}));const C=new IntersectionObserver((t=>{if(g)return;const e=t.sort(((t,e)=>t.target.getBoundingClientRect().top-e.target.getBoundingClientRect().top));for(const o of e){const{isIntersecting:t,target:e,boundingClientRect:n,rootBounds:c}=o;if(c&&!(c.bottom-n.bottom>c.bottom/2)){if(t){v(e);break}{const t=Array.from(p),o=t.indexOf(e);if(n.top>0){const e=t[Math.max(o-1,0)];v(e);break}}}}}),{threshold:[0],rootMargin:"0% 0% -50% 0%"});requestAnimationFrame((()=>{document.documentElement.style.scrollBehavior="smooth"})),p.forEach((t=>{C.observe(t)}));const x=document.querySelector(".article-header");if(x){new IntersectionObserver((([t])=>{o.classList.toggle("toc-collapsed",!t.isIntersecting)}),{threshold:0,rootMargin:"-20px 0px 0px 0px"}).observe(x)}})();
